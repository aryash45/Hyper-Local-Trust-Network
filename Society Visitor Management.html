<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Society Visitor Management</title>
  <style>
    body { 
      font-family: Arial, sans-serif; max-width: 600px; margin: 40px auto; background:#fafbfe;
      padding: 1em; border-radius: 12px; box-shadow: 0 1px 8px #bbb;
    }
    h2 { margin-top: 0; }
    .tabs { margin-bottom: 25px; }
    .tab-btn {
      padding: 10px 20px; border: none; background: #e6e6f7; cursor: pointer;
      margin-right: 10px; border-radius: 6px 6px 0 0; outline:none;
    }
    .tab-btn.active { background: #6c63ff; color: #fff; }
    .panel { display: none; }
    .panel.active { display: block; }
    label { margin-top: 12px; display: block; font-weight: bold; }
    input, select, button {
      margin-top: 6px; margin-bottom: 14px; display: block; width: 100%;
      padding: 8px; border: 1px solid #ccc; border-radius: 4px;
    }
    button { width:auto; background: #6c63ff; color:#fff; border: none; font-weight: bold; cursor: pointer; }
    button:hover { background: #5146d6; }
    .visitor-card {
      border: 1px solid #dcdcec;
      background: #fff;
      margin-bottom: 14px; padding: 12px; border-radius: 6px;
      box-shadow: 0 1px 4px #eee;
    }
    .status {
      margin:10px 0 0 0;
      font-weight: bold;
    }
    .approved { color: green; }
    .rejected { color: crimson; }
    .pending { color: #c18411; }
  </style>
</head>
<body>
  <h2>Society Visitor Management</h2>
  <div class="tabs">
    <button class="tab-btn active" onclick="showPanel('guard')">Guard Panel</button>
    <button class="tab-btn" onclick="showPanel('resident')">Resident Panel</button>
  </div>

  <div id="guard" class="panel active">
    <form id="guardForm">
      <label>Visitor Name</label>
      <input id="g_name" type="text" required>

      <label>Phone</label>
      <input id="g_phone" type="tel" required>

      <label>Purpose</label>
      <input id="g_purpose" type="text" required>

      <label>Block</label>
      <select id="g_block" required>
        <option value="">Select Block</option>
        <option>A</option><option>B</option><option>C</option>
      </select>
      <label>Flat No.</label>
      <input id="g_flat" type="text" required>

      <button type="submit">Log Visitor</button>
    </form>
    <div id="guard_status"></div>
    <div id="guardVisitorsList"></div>
  </div>

  <div id="resident" class="panel">
    <h3>Pending Visitors</h3>
    <div id="residentVisitors"></div>
  </div>

<script>
  // Switch Panel Logic
  function showPanel(panel) {
    document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
    document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
    document.getElementById(panel).classList.add('active');
    document.querySelector('.tab-btn' + (panel === "guard" ? ":first-child" : ":last-child")).classList.add('active');
    if(panel === "resident") renderResident();
    if(panel === "guard") renderGuardVisitors();
  }

  // Utility: Get/Set localStorage
  function getVisitors() {
    return JSON.parse(localStorage.getItem("visitors") || "[]");
  }
  function setVisitors(visitors) {
    localStorage.setItem("visitors", JSON.stringify(visitors));
  }

  // Guard Panel logic
  document.getElementById("guardForm").onsubmit = function(e) {
    e.preventDefault();
    const name = document.getElementById("g_name").value.trim();
    const phone = document.getElementById("g_phone").value.trim();
    const purpose = document.getElementById("g_purpose").value.trim();
    const block = document.getElementById("g_block").value;
    const flat = document.getElementById("g_flat").value.trim();

    if(!(name&&phone&&purpose&&block&&flat)){
      showMsg("guard_status", "Fill all fields.", "crimson");
      return;
    }

    const visitors = getVisitors();
    visitors.push({
      id: Date.now(),
      name, phone, purpose, block, flat,
      status: "Pending", time: new Date().toLocaleString()
    });
    setVisitors(visitors);
    document.getElementById("guardForm").reset();
    showMsg("guard_status", "Visitor request sent to resident.", "#008b27");
    renderGuardVisitors();
  };

  function renderGuardVisitors() {
    const list = getVisitors();
    let html = '<h3 style="margin:20px 0 5px 0;">Visitor Log</h3>';
    if(!list.length) html += "<em>No visitors logged yet.</em>";
    else list.slice().reverse().forEach(v => {
      let sclass = v.status === "Pending" ? "pending" : v.status === "Approved" ? "approved" : "rejected";
      html += `<div class="visitor-card">
        <b>${v.name}</b> to Block ${v.block} Flat ${v.flat}<br>
        Phone: ${v.phone} | Purpose: ${v.purpose}<br>At: ${v.time}
        <div class="status ${sclass}">Status: ${v.status}</div>
      </div>`;
    });
    document.getElementById("guardVisitorsList").innerHTML = html;
  }

  // Resident Panel logic
  function renderResident() {
    const visitors = getVisitors().filter(v => v.status === "Pending");
    let html = "";
    if(!visitors.length) html = "<em>No pending visitors.</em>";
    else visitors.slice().reverse().forEach(v => {
      html += `<div class="visitor-card">
        <b>${v.name}</b> wants to visit Block ${v.block} Flat ${v.flat}<br>
        Phone: ${v.phone} | Purpose: ${v.purpose}<br>At: ${v.time}
        <div>
          <button onclick="respondVisitor(${v.id},'Approved')">✅ Approve</button>
          <button onclick="respondVisitor(${v.id},'Rejected')">❌ Reject</button>
        </div>
      </div>`;
    });
    document.getElementById("residentVisitors").innerHTML = html;
  }

  window.respondVisitor = function(id, decision) {
    let visitors = getVisitors();
    let idx = visitors.findIndex(v => v.id === id && v.status === "Pending");
    if(idx > -1) {
      visitors[idx].status = decision;
      setVisitors(visitors);
      renderResident();
      renderGuardVisitors();
    }
  };

  function showMsg(id, msg, color) {
    let d = document.getElementById(id);
    d.textContent = msg; d.style.color = color || "#008b27";
    setTimeout(() => { d.textContent = ""; }, 2000);
  }

  // Initial rendering
  renderGuardVisitors();

</script>
</body>
</html>
